<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Static Site Generator (Formspree)</title>
  <style>
    body { font-family:Segoe UI, sans-serif; margin:20px auto; max-width:1200px; color:#333; }
    h1,h2 { color:#2c3e50; }
    .container { display:flex; gap:20px; }
    .form-section, .preview-section {
      flex:1; background:#f8f9fa; padding:20px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1);
    }
    .form-group { margin-bottom:15px; }
    label { font-weight:bold; display:block; margin-bottom:5px; }
    input, textarea { width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:16px; }
    textarea { min-height:80px; resize:vertical; }
    .char-counter { font-size:12px; color:#666; text-align:right; }
    .warning { color:#c00; }
    .responsive-controls { margin-bottom:15px; display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .width-slider, .height-slider { flex:1; min-width:150px; }
    .width-display, .height-display { width:60px; text-align:center; font-family:monospace; }
    .preset-buttons button { margin-right:5px; padding:4px 8px; font-size:12px; }
    button { background:#007bff; color:#fff; border:none; padding:10px 15px; border-radius:4px; cursor:pointer; }
    button:hover { background:#0069d9; }
    #preview { border:1px solid #ddd; background:#fff; resize:both; overflow:auto; min-width:300px; min-height:400px; }
  </style>
</head>
<body>
  <h1>Static Site Generator</h1>
  <p>Fill out the form and watch the live preview. When you’re ready, click Submit.</p>

  <div class="container">
    <div class="form-section">
      <h2>Content Form</h2>
      <form id="contentForm" action="https://formspree.io/f/xjvqvrvg" method="POST">
        <!-- Accent color is included manually; everything else is injected by JS -->
        <div class="form-group">
          <label for="accentColor">Accent Color <code>{{accentColor}}</code></label>
          <input type="color" id="accentColor" name="accentColor" value="#007bff" maxlength="7">
          <div class="char-counter"><span id="accentColorCount">0</span>/7</div>
        </div>
        <button type="submit">Submit</button>
      </form>
    </div>

    <div class="preview-section">
      <h2>Preview</h2>
      <div class="responsive-controls">
        <div class="preset-buttons">
          <button data-width="375">Mobile</button>
          <button data-width="768">Tablet</button>
          <button data-width="1024">Laptop</button>
          <button data-width="1440">Desktop</button>
        </div>
        <input type="range" id="widthSlider" class="width-slider" min="320" max="1440" value="880">
        <div class="width-display" id="widthDisplay">880px</div>
        <input type="range" id="heightSlider" class="height-slider" min="400" max="1200" value="600">
        <div class="height-display" id="heightDisplay">600px</div>
      </div>
      <div id="preview"><p>Loading preview…</p></div>
    </div>
  </div>

  <script>
    // Fallback sample if template.html won't load
    const sampleTemplate = `
<!DOCTYPE html>
<html><head><meta charset="utf-8"><title>{{siteTitle}}</title></head>
<body><h1 style="color:{{accentColor}}">{{bigIntro}}</h1><p>{{smallIntro}}</p></body>
</html>`;

    let template = '';
    async function loadTemplate() {
      try {
        const res = await fetch('template.html');
        template = res.ok ? await res.text() : sampleTemplate;
      } catch {
        template = sampleTemplate;
      }
    }

    // Define your real placeholders here
    const placeholders = [
      'siteTitle','metaDescription','canonicalUrl','ogUrl',
      'bigIntro','smallIntro','aboutHeader','aboutText',
      'footerText'
      // add yours...
    ];

    function buildForm() {
      const form = document.getElementById('contentForm');
      const accentEl = document.getElementById('accentColor').closest('.form-group');

      placeholders.forEach(name => {
        const group = document.createElement('div');
        group.className = 'form-group';
        const lbl = document.createElement('label');
        lbl.htmlFor = name;
        lbl.innerHTML = `${name} <code>{{${name}}}</code>`;
        group.appendChild(lbl);

        const inp = document.createElement(
          name.toLowerCase().includes('description') || name==='aboutText' || name==='footerText'
            ? 'textarea' : 'input'
        );
        inp.id = inp.name = name;
        inp.maxLength =  name==='metaDescription' ? 155 : 50;
        group.appendChild(inp);

        const counter = document.createElement('div');
        counter.className = 'char-counter';
        counter.innerHTML = `<span id="${name}Count">0</span>/`+inp.maxLength;
        group.appendChild(counter);

        form.insertBefore(group, accentEl);
      });

      form.querySelectorAll('input,textarea').forEach(el => {
        el.addEventListener('input', () => {
          const cnt = document.getElementById(el.id+'Count');
          if (cnt) {
            cnt.textContent = el.value.length;
            cnt.classList.toggle('warning', el.value.length > el.maxLength * .8);
          }
          renderPreview();
        });
      });
    }

    function renderPreview() {
      const data = new FormData(document.getElementById('contentForm'));
      let html = template.replace(
        /<head(\b[^>]*)>/i,
        `<head$1><style>body{color:#333!important}</style>`
      );
      html = html.replace(/{{\s*([\w]+)\s*}}/g, (_,key)=>(data.get(key)||''));
      const iframe = `<iframe style="width:100%;height:100%;border:0" srcdoc="${html.replace(/"/g,'&quot;')}"></iframe>`;
      document.getElementById('preview').innerHTML = iframe;
      adjustPreviewDims();
    }

    function adjustPreviewDims() {
      const w = +document.getElementById('widthSlider').value;
      const h = +document.getElementById('heightSlider').value;
      document.getElementById('widthDisplay').textContent = w+'px';
      document.getElementById('heightDisplay').textContent = h+'px';
      const p = document.getElementById('preview');
      p.style.width = w+'px';
      p.style.height = h+'px';
    }

    function setupResponsive() {
      document.getElementById('widthSlider').addEventListener('input', renderPreview);
      document.getElementById('heightSlider').addEventListener('input', renderPreview);
      document.querySelectorAll('.preset-buttons button').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          document.getElementById('widthSlider').value = btn.dataset.width;
          renderPreview();
        });
      });
    }

    (async()=>{
      await loadTemplate();
      buildForm();
      setupResponsive();
      renderPreview();
    })();
  </script>
</body>
</html>
